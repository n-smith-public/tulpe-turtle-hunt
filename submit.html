<!DOCTYPE html>
<html>
    <head>
        <title>Submission</title>
        <link rel="stylesheet" href="/CSS/title.css">
    </head>

    <body class="titleBackground">
        <main>
            <section>
                <img class="titleForeground" src="/Media/foreground.png" alt="Foreground Image">
                <div class="titleText">
                    <h1 class="submit">Who Are You?</h1>
                </div>

                <div class="submission">
                    <form id="dataForm">
                        <label for="firstName">First Name:</label>
                        <input type="text" id="firstName" name="firstName" required>
                        <label for="lastName">Last Name:</label>
                        <input type="text" id="lastName" name="lastName">
                        <label for="pronouns">Pronouns:</label>
                        <input type="text" id="pronouns" name="pronouns">
                        <label for="lodge">Lodge:</label>
                        <input type="text" id="lodge" name="lodge">
                        <label for="email">Email:</label>
                        <input type="email" id="email" name="email" required>
                        <label for="discord">Discord:</label>
                        <input type="text" id="discord" name="discord">
                        <label for="comments">Comments:</label>
                        <input id="comments" name="comments"></textarea>
                        <button type="submit" id="submitBtn">Submit</button>
                    </form>
                </div>
            </section>
        </main>

        <script src="script.js"></script>
    <script>
        document.getElementById('submitBtn').addEventListener('click', function() {
            fetch('/')
            .then(() => {
                setTimeout(function() {
                    submitForm();
                }, 60000);
            })
            .catch(error => {
                console.error('Error waking up the server: ', error);
                alert('There was an error. Please try again later. If this persists, contact greenbueller@greenbueller.com');
            });
        });

        function submitForm() {
            const formData = {
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                pronouns: document.getElementById('pronouns').value,
                lodge: document.getElementById('lodge').value,
                email: document.getElementById('email').value,
                discord: document.getElementById('discord').value,
                comments: document.getElementById('comments').value,
            };

            fetch('/submit', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData),
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
            })
            .catch(error => {
                console.error('Error: ', error);
            });
        }
    </script>
    </body>
</html>